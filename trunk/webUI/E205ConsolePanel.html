<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>retro-205 Console Control Panel</title>
<!--
/***********************************************************************
* retro-205/D205ConsolePanel.html
************************************************************************
* Copyright (c) 2014, Paul Kimpel.
* Licensed under the MIT License, see
*       http://www.opensource.org/licenses/mit-license.php
************************************************************************
* Electrodata/Burroughs Datatron 205 Console Control Panel page.
************************************************************************
* 2014-10-04  P.Kimpel
*   Original version, from retro-b5500 B5500ProcessorPanel.html prototype.
***********************************************************************/
-->
<meta name="Author" content="Paul Kimpel">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<link id=defaultStyleSheet rel=stylesheet type="text/css" href="E205Panel.css">

<script src="./E205PanelUtil.js"></script>      <!-- must be first -->

<script>
window.onload = function() {
    var body = window.document.body;
    var box;
    var displayRefreshPeriod = 50;      // milliseconds
    var e;
    var intervalToken = 0;
    var regA = new PanelRegister(44,  3, 2, 4, "A REGISTER");
    var regR = new PanelRegister(40, 15, 2, 4, "R REGISTER");
    var regD = new PanelRegister(44,  3, 7, 4, "D REGISTER");
    var regB = new PanelRegister(16, 15, 7, 4, "B REGISTER");
    var regC = new PanelRegister(40, 20, 7, 4, "C REGISTER");
    var x;

    function setLamp(id, value, lampClass, litClass) {
        var bit = value % 2;
        var e = document.getElementById(id);

        e.className = (bit ? lampClass + " " + litClass : lampClass);
        return (value-bit)/2;
    }

    function updateDisplay() {
        var lampMask = Math.floor(Math.random()*1024);

        regA.update(Math.random()*Math.random()*0x100000000000);
        regR.update(Math.random()*Math.random()*0x10000000000);
        regD.update(Math.random()*Math.random()*0x100000000000);
        regB.update(Math.random()*0x10000);
        regC.update(Math.random()*Math.random()*0x10000000000);

        lampMask = setLamp("IdleLamp", lampMask, "redLamp", "redLit");
        lampMask = setLamp("FCSALamp", lampMask, "orangeLamp", "orangeLit");
        lampMask = setLamp("ControlLamp", lampMask, "orangeLamp", "orangeLit");
        lampMask = setLamp("BKPTLamp", lampMask, "orangeLamp", "orangeLit");
        lampMask = setLamp("OverflowLamp", lampMask, "redLamp", "redLit");
        lampMask = setLamp("ExecuteLamp", lampMask, "whiteLamp", "whiteLit");
        lampMask = setLamp("FetchLamp", lampMask, "whiteLamp", "whiteLit");
        lampMask = setLamp("NotReadyLamp", lampMask, "redLamp", "redLit");
        lampMask = setLamp("ContinuousLamp", lampMask, "greenLamp", "greenLit");
    }

    function stepBtn_Click(ev) {
        if (intervalToken) {
            clearInterval(intervalToken);
            intervalToken = 0;
        }
        updateDisplay();
    }

    function stopBtn_Click(ev) {
        if (intervalToken) {
            clearInterval(intervalToken);
            intervalToken = 0;
        }
    }

    function contBtn_Click(ev) {
        if (!intervalToken) {
            intervalToken = setInterval(updateDisplay, displayRefreshPeriod);
        }
        updateDisplay();
    }

    function flipSwitch(ev) {
        var img = ev.target;
        var src = img.src;

        if (src.indexOf("Down") > 0) {
            img.src = src.replace("Down", "Up");
        } else if (src.indexOf("Up") > 0) {
            img.src = src.replace("Up", "Down");
        }
    }


    // Start of window.onload
    body.appendChild(regA.element);
    regA.drawBox(1, 1, 4, "", "1px solid black");
    regA.drawBox(6, 2, 4, "1px dashed black", "1px dashed black");
    regA.lamps[43].setCaption("A-SG");
    for (x=1; x<=10; x++) {
        regA.lamps[43-x*4].setCaption("A-"+x);
    }

    body.appendChild(regB.element);
    for (x=1; x<=4; x++) {
        regB.lamps[19-x*4].setCaption("B-"+x);
    }

    body.appendChild(regC.element);
    box = regC.drawBox(1, 2, 4, "", "");
    regC.setBoxCaption(box, "ORDER");
    box = regC.drawBox(3, 4, 4, "1px solid black", "1px solid black");
    regC.setBoxCaption(box, "ADDRESS");
    box = regC.drawBox(7, 4, 4, "", "");
    regC.setBoxCaption(box, "CONTROL ADDRESS");

    body.appendChild(regD.element);
    regD.drawBox(1, 1, 4, "", "1px solid black");
    regD.drawBox(6, 2, 4, "1px dashed black", "1px dashed black");
    regD.lamps[43].setCaption("D-SG");
    for (x=1; x<=10; x++) {
        regD.lamps[43-x*4].setCaption("D-"+x);
    }

    body.appendChild(regR.element);
    regR.drawBox(1, 4, 4, "", "1px dashed black");
    for (x=1; x<=10; x++) {
        regR.lamps[43-x*4].setCaption("R-"+x);
    }

    e = document.getElementById("LogoPanel");
    e.style.left = (26*PanelRegister.hSpacing-PanelRegister.hOffset).toString() + "px";
    e.style.top = (2*PanelRegister.vSpacing-PanelRegister.vOffset).toString() + "px";
    e.style.width = (3*PanelRegister.hSpacing + 2*PanelRegister.hOffset + PanelRegister.lampDiameter).toString() + "px";
    e.style.height = (3*PanelRegister.vSpacing + 2*PanelRegister.vOffset + PanelRegister.lampDiameter).toString() + "px";

    document.getElementById("StepBtn").addEventListener("click", stepBtn_Click);
    document.getElementById("StopBtn").addEventListener("click", stopBtn_Click);
    document.getElementById("ContBtn").addEventListener("click", contBtn_Click);
    document.getElementById("POSuppressSwitch").addEventListener("click", flipSwitch);
    document.getElementById("SkipSwitch").addEventListener("click", flipSwitch);
    document.getElementById("AudibleAlarmSwitch").addEventListener("click", flipSwitch);
    //intervalToken = setInterval(updateDisplay, displayRefreshPeriod);
};
</script>
</head>

<body class="panelBody">

<div id=LogoPanel class="panelRegister">
    <div id=LogoText1>CONTROL CONSOLE</div>
    <div id=LogoText2>ELECTRODATA</div>
    <div id=LogoText3>CORPORATION</div>
    <div id=LogoText4>PASADENA</div>
    <div id=LogoText5>CALIFORNIA</div>
</div>

<div id=OutputKnob class="blackKnob1"><&nbsp;</div>
<div id=OutputKnobCaption class=caption>OUTPUT</div>
<div id=OutputKnobTape class=caption>TAPE</div>
<div id=OutputKnobOff class=caption>OFF</div>
<div id=OutputKnobPage class=caption>PAGE</div>

<img id=POSuppressSwitch src="./resources/ToggleDown.png">
<div id=POSuppressCaption class=caption>P.O. SUPPRESS</div>
<div id=POSuppressOn class=caption>ON</div>
<div id=POSuppressOff class=caption>OFF</div>

<img id=SkipSwitch src="./resources/ToggleDown.png">
<div id=SkipSwitchCaption class=caption>SKIP</div>
<div id=SkipSwitchOn class=caption>ON</div>
<div id=SkipSwitchOff class=caption>OFF</div>

<div id=ClearBtn class="redButton1">&nbsp;</div>
<div id=ClearBtnCaption class=caption>CLEAR</div>

<div id=ComputerStopCaption class=panelCaption>
    <span class=panelSpan>COMPUTER STOP</span>
</div>

<div id=IdleLamp class="redLamp"></div>
<div id=IdleLampCaption class=caption>IDLE</div>
<img id=AudibleAlarmSwitch src="./resources/ToggleDown.png">
<div id=AudibleAlarmOn class=caption>ON</div>
<div id=AudibleAlarmOff class=caption>OFF<br>AUDIBLE ALARM</div>

<div id=FCSALamp class="orangeLamp"></div>
<div id=FCSALampCaption class=caption>FC/SA</div>
<div id=ControlLamp class="orangeLamp"></div>
<div id=ControlLampCaption class=caption>CONTROL</div>
<div id=BKPTLamp class="orangeLamp"></div>
<div id=BKPTLampCaption class=caption>BKPT</div>

<div id=BreakpointKnob class="blackKnob1"><&nbsp;</div>
<div id=BreakpointKnobCaption class=caption>BREAKPOINT</div>
<div id=BreakpointKnobOff class=caption>OFF</div>
<div id=BreakpointKnob4 class=caption>4</div>
<div id=BreakpointKnob2 class=caption>2</div>
<div id=BreakpointKnob1 class=caption>1</div>

<div id=OverflowLamp class="redLamp"></div>
<div id=OverflowLampCaption class=caption>OVERFLOW</div>
<div id=ResetBtn class="blackButton1">&nbsp;</div>
<div id=ResetBtnCaption class=caption>RESET</div>

<div id=TimingToggleCaption class=caption>TIMING TOGGLE</div>
<div id=ExecuteLamp class="whiteLamp"></div>
<div id=ExecuteLampCaption class=caption>EXECUTE</div>
<div id=FetchLamp class="whiteLamp"></div>
<div id=FetchLampCaption class=caption>FETCH</div>

<div id=OperationCaption class=panelCaption>
    <span class=panelSpan>OPERATION</span>
</div>

<div id=NotReadyLamp class="redLamp"></div>
<div id=NotReadyLampCaption class=caption>NOT READY</div>
<div id=StepBtn class="redButton1">&nbsp;</div>
<div id=StepBtnCaption class=caption>STEP</div>
<div id=ContinuousLamp class="greenLamp"></div>
<div id=ContinuousLampCaption class=caption>CONTINUOUS</div>

<div id=StopBtn class="blackButton1">&nbsp;</div>
<div id=StopBtnCaption class=caption>STOP</div>
<div id=ContBtn class="blackButton1">&nbsp;</div>
<div id=ContBtnCaption class=caption>CONT</div>

<div id=InputKnob class="blackKnob1"><&nbsp;</div>
<div id=InputKnobCaption class=caption>INPUT</div>
<div id=InputKnobReader class=caption>MECH.<br>READER</div>
<div id=InputKnobOpticalReader class=caption>OPTICAL<br>READER</div>
<div id=InputKnobKeyboard class=caption>KEYBOARD</div>

</body>
</html>